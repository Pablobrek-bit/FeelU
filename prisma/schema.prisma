generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  email     String    @unique
  password  String
  role      Role      @default(USER)
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")
  deleted   Boolean?  @default(false)
  filter    Filter?
  like      Like[]
  match     Match[]
  profile   Profile?
  view      View[]

  @@index([deleted], map: "idx_users_deleted")
}

model Profile {
  id                    String            @id @default(uuid()) @db.Uuid
  userId                String            @unique @db.Uuid
  name                  String
  age                   Int
  course                String?
  institution           String?
  bio                   String
  avatarUrl             String            @map("avatar_url")
  instagramUrl          String?           @map("instagram_url")
  favoriteEmoji         String?           @map("favorite_emoji")
  gender                Gender
  sexualOrientation     SexualOrientation @map("sexual_orientation")
  showGender            Boolean           @default(true) @map("show_gender")
  showSexualOrientation Boolean           @default(true) @map("show_sexual_orientation")
  deleted               Boolean?          @default(false)
  deletedAt             DateTime?         @map("deleted_at")
  user                  User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([gender, sexualOrientation], map: "idx_profiles_filter")
  @@index([deleted], map: "idx_profiles_deleted")
}

model Filter {
  id          String             @id @default(uuid()) @db.Uuid
  userId      String             @unique @db.Uuid
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  preferences FilterPreference[]

  @@index([userId], map: "idx_filters_user_id")
}

model FilterPreference {
  id                String            @id @default(uuid()) @db.Uuid
  filterId          String            @db.Uuid
  gender            Gender
  sexualOrientation SexualOrientation
  filter            Filter            @relation(fields: [filterId], references: [id], onDelete: Cascade)

  @@index([filterId], map: "idx_filter_preferences_filter_id")
}

model Like {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @db.Uuid
  likedUser String   @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([likedUser], map: "idx_likes_liked_user")
}

model Match {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String   @db.Uuid
  matchedUser String   @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([matchedUser], map: "idx_matches_matched_user")
}

model View {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String   @db.Uuid
  viewedUser String   @db.Uuid
  createdAt  DateTime @default(now()) @map("created_at")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, viewedUser])
  @@index([userId], map: "idx_views_user_id")
  @@index([viewedUser], map: "idx_views_viewed_user")
}

enum Gender {
  HOMEM
  MULHER
  NAO_BINARIO
}

enum SexualOrientation {
  HETERO
  HOMOSSEXUAL
  BI
  PAN
}

enum Role {
  USER
  ADMIN
}
